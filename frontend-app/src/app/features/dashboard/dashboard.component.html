<div class="h-full bg-[var(--sys-surface)] text-[var(--sys-on-surface)] flex flex-col transition-colors duration-300">
    <!-- Main Content -->
    <main class="flex-1 p-6 lg:p-10 max-w-7xl mx-auto w-full space-y-8">

        <!-- Stats Row -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <!-- Total Devices -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 relative overflow-hidden group">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                </div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-zinc-400 text-sm font-medium mb-1">Total Devices</p>
                        <h2 class="text-4xl font-bold text-white">{{ totalDevices() }}</h2>
                    </div>
                    <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 002-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Online Devices -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 relative overflow-hidden group">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                </div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-zinc-400 text-sm font-medium mb-1">Online</p>
                        <h2 class="text-4xl font-bold text-white">{{ onlineDevices() }}</h2>
                    </div>
                    <div class="p-3 bg-emerald-500/10 rounded-xl text-emerald-400">
                        <div class="h-6 w-6 rounded-full border-2 border-emerald-400 flex items-center justify-center">
                            <div
                                class="h-3 w-3 bg-emerald-400 rounded-full animate-pulse shadow-[0_0_10px_rgba(16,185,129,0.8)]">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Offline Devices -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 relative overflow-hidden group">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-red-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                </div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-zinc-400 text-sm font-medium mb-1">Offline</p>
                        <h2 class="text-4xl font-bold text-white">{{ offlineDevices() }}</h2>
                    </div>
                    <div class="p-3 bg-red-500/10 rounded-xl text-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                </div>
            </div>

        </div>

        <!-- Dashboard Data Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Active Devices Table -->
            <div
                class="lg:col-span-2 bg-zinc-900 border border-zinc-800 rounded-2xl overflow-hidden shadow-lg flex flex-col">
                <div class="px-6 py-5 border-b border-zinc-800 flex justify-between items-center bg-zinc-900/50">
                    <h3 class="text-lg font-semibold text-white">Active RMD Devices</h3>
                    <button
                        class="text-sm bg-zinc-800 hover:bg-zinc-700 text-zinc-300 px-4 py-2 rounded-lg transition-colors border border-zinc-700">View
                        Map</button>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-zinc-900/80 text-zinc-400 text-xs uppercase tracking-wider">
                                <th class="px-6 py-4 font-medium">Status</th>
                                <th class="px-6 py-4 font-medium">Device UID</th>
                                <th class="px-6 py-4 font-medium">Name</th>
                                <th class="px-6 py-4 font-medium">Last Seen</th>
                                <th class="px-6 py-4 font-medium text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-zinc-800/60 transition-all text-sm">
                            @for (device of devices(); track device.id) {
                            <tr class="hover:bg-zinc-800/40 group cursor-pointer transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    @if(device.status === 'online') {
                                    <span
                                        class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                                        <span
                                            class="w-2 h-2 mr-1.5 bg-emerald-400 rounded-full animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.8)]"></span>
                                        Online
                                    </span>
                                    } @else {
                                    <span
                                        class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-zinc-500/10 text-zinc-400 border border-zinc-500/20">
                                        <span class="w-2 h-2 mr-1.5 bg-zinc-400 rounded-full"></span> Offline
                                    </span>
                                    }
                                </td>
                                <td class="px-6 py-4 text-zinc-300 font-mono text-xs">{{ device.uid }}</td>
                                <td class="px-6 py-4 text-white font-medium">{{ device.name || 'Unnamed Device' }}</td>
                                <td class="px-6 py-4 text-zinc-400">{{ device.last_seen | date:'MMM d, y, h:mm:ss a' }}
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <button
                                        class="text-emerald-400 hover:text-emerald-300 transition-colors font-medium">Details
                                        â†’</button>
                                </td>
                            </tr>
                            }
                            @if(devices().length === 0 && !isLoading()) {
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-zinc-500">
                                    No devices detected yet. Ensure your MQTT workers are running.
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Device Status Chart -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl overflow-hidden shadow-lg flex flex-col">
                <div class="px-6 py-5 border-b border-zinc-800 flex justify-between items-center bg-zinc-900/50">
                    <h3 class="text-lg font-semibold text-white">Status Overview</h3>
                </div>
                <div class="p-6 flex-1 flex items-center justify-center min-h-[300px] relative">
                    <canvas baseChart [data]="pieChartData()" [options]="pieChartOptions" [type]="'pie'">
                    </canvas>
                </div>
            </div>

        </div>
    </main>
</div>